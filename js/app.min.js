/*!
 * coordinates.io
 *
 * app.js
 * Author: Michael Birsak
 * Version: 0.0.1
 *
 * (c) 2013 Michael Birsak / Thomas Lichtblau
 * Licensed under MIT
 *//*************************************************************************//* coordinates.io - App
/*************************************************************************/(function(e,t,n,r){var i={options:{},elements:{map:t.getElementById("coordinates-map"),searchInput:t.getElementById("coordinates-search-input"),searchInputTop:t.getElementById("coordinates-search-input-top"),$searchInput:n("#coordinates-search-input"),$searchInputTop:n("#coordinates-search-input-top"),$swLat:n("#coordinates-swlat"),$swLng:n("#coordinates-swlng"),$neLat:n("#coordinates-nelat"),$neLng:n("#coordinates-nelng"),$point:n("#coordinates-point"),$clipBoundaries:n("#coordinates-clip-boundaries"),$clipMarker:n("#coordinates-clip-marker"),$topBar:n("#coordinates-top-bar"),$bottomBar:n("#coordinates-bottom-bar"),$mainOverlay:n("#coordinates-overlay"),$helper:n("#coordinates-helper"),$label:n(".coordinate-label"),$tooltip:n(".tooltip"),$aboutLink:n("#coordinates-about-link a"),$aboutBox:n("#coordinates-about"),$inputOverlay:n(".input-overlay")},setOptions:function(){i.options.locationCenter=new Array(new google.maps.LatLng(40.70196698225911,-74.0003790435791),new google.maps.LatLng(38.080443167851655,22.630730867385864),new google.maps.LatLng(27.88977386224803,-82.84113585948944),new google.maps.LatLng(63.1001412,21.59100000001));i.options.mapOptions={center:i.options.locationCenter[Math.floor(Math.random()*4)],zoom:16,disableDefaultUI:!0,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,position:google.maps.ControlPosition.BOTTOM_CENTER},mapTypeId:google.maps.MapTypeId.SATELLITE};i.options.rectangleOptions={bounds:i.options.bounds,editable:!0,draggable:!0,fillColor:"#2fe6c1",fillOpacity:.4,strokeWeight:0};i.options.placesOptions={types:["geocode"]};i.options.markerOptions={icon:"img/marker.png"};i.options.zeroClipboardOptions={moviePath:"js/vendor/ZeroClipboard.swf",forceHandCursor:!0};i.options.toolTipsterOptions={trigger:"custom",offsetY:5};i.options.bounds=null;i.options.initialSearch=!0},init:function(){i.setOptions();i.map=new google.maps.Map(i.elements.map,i.options.mapOptions);i.rectangle=new google.maps.Rectangle(i.options.rectangleOptions);i.autocomplete=new google.maps.places.Autocomplete(i.elements.searchInput,i.options.placesOptions);i.autocompleteTop=new google.maps.places.Autocomplete(i.elements.searchInputTop,i.options.placesOptions);i.marker=new google.maps.Marker(i.options.markerOptions);i.marker.setMap(i.map);i.clip=new ZeroClipboard(i.elements.$label,i.options.zeroClipboardOptions);i.registerEvents();i.elements.$mainOverlay.delay(500).transition({"margin-top":"-75px",opacity:1},700);i.elements.$helper.delay(250).fadeIn("slow");i.elements.$searchInput.focus();i.elements.$tooltip.tooltipster(i.options.toolTipsterOptions)},registerEvents:function(){google.maps.event.addListener(i.autocomplete,"place_changed",function(){i.placeChanged(i.autocomplete)});google.maps.event.addListener(i.autocompleteTop,"place_changed",function(){i.placeChanged(i.autocompleteTop)});google.maps.event.addListener(i.rectangle,"bounds_changed",function(){i.rectangleBoundsChanged()});google.maps.event.addListener(i.map,"click",function(e){i.setMarker(e.latLng)});google.maps.event.addListener(i.map,"maptypeid_changed",function(){i.mapTypeChanged()});i.elements.$searchInput.one("keypress",function(){i.elements.$helper.html("Now select the right one.")});i.elements.$searchInputTop.one("mouseover",function(){i.elements.$tooltip.tooltipster("hide")});i.elements.$aboutLink.on("click",i.toggleAbout);i.elements.$aboutBox.on("click",i.toggleAbout)},toggleAbout:function(){i.elements.$aboutBox.is(":visible")?i.elements.$aboutBox.css("display","block").transition({opacity:0,"margin-top":"-170px"},function(){i.elements.$aboutBox.hide()}):i.elements.$aboutBox.css("display","block").transition({opacity:1,"margin-top":"-200px"})},loadMapScript:function(){var e=t.createElement("script");e.type="text/javascript";e.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA0UG5tXW2lWXZmBdDgJPnqi2r1aDTxNgE&v=3.exp&sensor=true&libraries=places&callback=initializeApplication";t.body.appendChild(e)},openBars:function(){i.elements.$searchInputTop.val(i.elements.$searchInput.val());n("#coordinates-bottom-bar span").show();i.elements.$topBar.addClass("open");setTimeout(function(){i.elements.$bottomBar.addClass("open");i.elements.$tooltip.tooltipster("show");setTimeout(function(){i.elements.$tooltip.tooltipster("hide")},3e3)},800);i.options.initialSearch=!1},setLocation:function(){if(typeof i.options.bounds!="undefined"){i.map.fitBounds(i.options.bounds);i.map.panTo(i.options.locationCenter);i.setRectangle();i.setMarker(i.options.locationCenter);i.options.initialSearch&&setTimeout(function(){i.openBars()},200)}else{i.map.panTo(i.options.locationCenter);i.setMarker(i.options.locationCenter);i.elements.$swLat.html("N/A");i.elements.$swLng.html("N/A");i.elements.$neLat.html("N/A");i.elements.$neLng.html("N/A");i.elements.$clipBoundaries.html("N/A");i.options.initialSearch&&setTimeout(function(){i.openBars()},200)}},setRectangle:function(){i.rectangle.setBounds(i.options.bounds);i.rectangle.setMap(i.map)},setMarker:function(e){var t=e.lat()+" , "+e.lng();i.marker.setPosition(e);i.elements.$point.html(t);i.elements.$clipMarker.html(t)},rectangleBoundsChanged:function(){var e=i.rectangle.bounds.getSouthWest(),t=i.rectangle.bounds.getNorthEast(),n=e.lng()+" , "+e.lat()+" , "+t.lng()+" , "+t.lat();i.elements.$swLat.html(e.lat());i.elements.$swLng.html(e.lng());i.elements.$neLat.html(t.lat());i.elements.$neLng.html(t.lng());i.elements.$clipBoundaries.html(n)},placeChanged:function(e){var t=e.getPlace();i.options.locationCenter=t.geometry.location;i.options.bounds=t.geometry.viewport;i.elements.$inputOverlay.fadeOut("fast");i.elements.$searchInput.fadeOut("fast");if(i.options.initialSearch){i.elements.$helper.fadeOut();i.elements.$mainOverlay.transition({"margin-top":"-30px",opacity:0},700,function(){i.elements.$mainOverlay.hide()});setTimeout(function(){i.setLocation()},500)}else i.setLocation()},mapTypeChanged:function(){i.map.getMapTypeId()==="roadmap"?i.rectangle.setOptions({fillOpacity:.7}):i.rectangle.setOptions({fillOpacity:.4})},tryGeolocation:function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){i.options.locationCenter=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);i.options.zoom=8;i.map.setCenter(i.options.locationCenter);i.map.setZoom(i.options.zoom)},function(){i.handleNoGeolocation(!0,map)}):i.handleNoGeolocation(!1,map)},handleNoGeolocation:function(e){i.map.setCenter(i.options.locationCenter[0]);i.map.setZoom(i.options.zoom)}};initializeApplication=function(){i.init()};n(e).on("load",i.loadMapScript)})(window,document,jQuery);